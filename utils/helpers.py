import json
import random
import re
from datetime import datetime

def is_valid_url(url: str) -> bool:
    """
    ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ»Ğ¸ ÑÑ‚Ñ€Ğ¾ĞºĞ° ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾Ğ¹ ÑÑÑ‹Ğ»ĞºĞ¾Ğ¹
    """
    if not url:
        return False
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° Telegram ÑÑÑ‹Ğ»ĞºĞ¸
    if url.startswith(('https://t.me/', 'http://t.me/', 't.me/')):
        return True
    
    # ĞĞ±Ñ‰Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° URL
    regex = re.compile(
        r'^(https?://)?'  # http:// or https://
        r'(\w+\.)?'       # subdomain
        r'\w+\.\w+'       # domain
        r'(/\S*)?$'       # path
    )
    return bool(re.match(regex, url))

def get_random_tip() -> str:
    """
    Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¹ ÑĞ¾Ğ²ĞµÑ‚ Ğ´Ğ»Ñ ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ¾Ğ¹ Ğ¼Ğ¾Ñ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸
    """
    tips = [
        "ğŸ§  Ğ£Ñ‡Ğ¸Ñ‚ĞµÑÑŒ Ğ¿Ğ¾Ğ½ĞµĞ¼Ğ½Ğ¾Ğ³Ñƒ, Ğ½Ğ¾ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ! 15 Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ² Ğ´ĞµĞ½ÑŒ ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½ĞµĞµ, Ñ‡ĞµĞ¼ 2 Ñ‡Ğ°ÑĞ° Ñ€Ğ°Ğ· Ğ² Ğ½ĞµĞ´ĞµĞ»Ñ.",
        "ğŸ“ Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ²Ğ°Ğ¶Ğ½Ñ‹Ğµ Ğ¼Ñ‹ÑĞ»Ğ¸ - ÑÑ‚Ğ¾ ÑƒĞ»ÑƒÑ‡ÑˆĞ°ĞµÑ‚ Ğ·Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ.",
        "ğŸ¯ Ğ¡Ñ‚Ğ°Ğ²ÑŒÑ‚Ğµ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğµ Ñ†ĞµĞ»Ğ¸ Ğ½Ğ° ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ.",
        "ğŸ’ª ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ğµ - Ğ¼Ğ°Ñ‚ÑŒ ÑƒÑ‡ĞµĞ½Ğ¸Ñ! ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞ¹Ñ‚Ğµ Ğ¿Ñ€Ğ¾Ğ¹Ğ´ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ» Ñ‡ĞµÑ€ĞµĞ· Ğ´ĞµĞ½ÑŒ.",
        "ğŸŒ™ Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğ¹ ÑĞ¾Ğ½ ÑƒĞ»ÑƒÑ‡ÑˆĞ°ĞµÑ‚ Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ Ğ¸ ÑĞ¿Ğ¾ÑĞ¾Ğ±Ğ½Ğ¾ÑÑ‚ÑŒ Ğº Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ.",
        "ğŸš¶â€â™‚ï¸ Ğ”ĞµĞ»Ğ°Ğ¹Ñ‚Ğµ Ğ¿ĞµÑ€ĞµÑ€Ñ‹Ğ²Ñ‹ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 25-30 Ğ¼Ğ¸Ğ½ÑƒÑ‚.",
        "ğŸ¤” ĞĞ±ÑŠÑÑĞ½ÑĞ¹Ñ‚Ğµ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ» Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼ - ÑÑ‚Ğ¾ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ½ÑÑ‚ÑŒ Ğ»ÑƒÑ‡ÑˆĞµ.",
        "ğŸ“š Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸.",
        "âš¡ ĞŸÑ€Ğ°ĞºÑ‚Ğ¸ĞºÑƒĞ¹Ñ‚ĞµÑÑŒ ĞºĞ°Ğº Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ.",
        "ğŸŒŸ ĞÑ‚Ğ´Ñ‹Ñ… Ñ‚Ğ°Ğº Ğ¶Ğµ Ğ²Ğ°Ğ¶ĞµĞ½, ĞºĞ°Ğº Ğ¸ ÑƒÑ‡ĞµĞ±Ğ°.",
        "ğŸ“ Ğ—Ğ½Ğ°Ğ½Ğ¸Ñ, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ½Ğµ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑÑÑ‚ÑÑ, Ğ·Ğ°Ğ±Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ. ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞ¹Ñ‚Ğµ ÑÑ€Ğ°Ğ·Ñƒ!",
        "ğŸ” Ğ˜Ñ‰Ğ¸Ñ‚Ğµ ÑĞ²ÑĞ·Ğ¸ Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğ¼Ğ¸ Ñ‚ĞµĞ¼Ğ°Ğ¼Ğ¸ - ÑÑ‚Ğ¾ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ½ÑÑ‚ÑŒ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½Ñƒ Ñ†ĞµĞ»Ğ¸ĞºĞ¾Ğ¼.",
        "ğŸ’¡ Ğ—Ğ°Ğ´Ğ°Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹. Ğ›ÑĞ±Ğ¾Ğ¿Ñ‹Ñ‚ÑÑ‚Ğ²Ğ¾ - Ğ´Ğ²Ğ¸Ğ³Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°.",
        "ğŸ“… ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ ÑĞ²Ğ¾Ñ‘ Ğ²Ñ€ĞµĞ¼Ñ. Ğ ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ğ¾ÑÑ‚ÑŒ Ğ²Ğ°Ğ¶Ğ½ĞµĞµ Ğ¸Ğ½Ñ‚ĞµĞ½ÑĞ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸.",
        "ğŸ† ĞÑ‚Ğ¼ĞµÑ‡Ğ°Ğ¹Ñ‚Ğµ ÑĞ²Ğ¾Ğ¸ ÑƒÑĞ¿ĞµÑ…Ğ¸, Ğ´Ğ°Ğ¶Ğµ Ğ¼Ğ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğµ."
    ]
    import random
    return random.choice(tips)

def format_profile(user) -> str:
    return f"""
ğŸ‘¤ <b>Ğ¢Ğ²Ğ¾Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ</b>

ğŸ†” ID: <code>{user.tg_id}</code>
Ğ˜Ğ¼Ñ: {user.name} {user.surname}
Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚: {user.age}
Ğ Ğ¾Ğ»ÑŒ: {user.role}
Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ: <b>Level {user.level}</b> ({user.xp} XP)
ğŸ“¸ Ğ¤Ğ¾Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ: Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ âœ…
    """.strip()

def beautiful_welcome(user_name: str) -> str:
    return f"""
ğŸ‰ <b>Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ, {user_name}!</b>

Ğ¯ â€” <b>MentorAI Bot</b> â€” Ñ‚Ğ²Ğ¾Ğ¹ Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ½Ğ°ÑÑ‚Ğ°Ğ²Ğ½Ğ¸Ğº Ğ² Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸.

Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ñ‹ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ ÑĞ²Ğ¾Ğ¹ Ğ¿ÑƒÑ‚ÑŒ Ğº Ğ½Ğ¾Ğ²Ñ‹Ğ¼ Ğ·Ğ½Ğ°Ğ½Ğ¸ÑĞ¼? ğŸš€
    """

async def load_faq():
    with open("data/faq.json", encoding="utf-8") as f:
        return json.load(f)